<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>KFC 420 Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --kfc-cyan: #27c4c2;
      --kfc-cyan-dark: #169ca4;
      --kfc-cyan-light: #78eceb;
      --kfc-card: #1a2224;
      --kfc-white: #fff;
      --kfc-gray: #ecf9f9;
      --kfc-shadow: 0 3px 20px #27c4c221, 0 1px 0 #28e4e41a;
    }
    body {
      margin: 0; background: #182224; color: var(--kfc-white);
      font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
    }
    .header {
      padding: 14px 0 6px 0;
      text-align: center;
      font-size: 1.25em;
      font-weight: 800;
      letter-spacing: 2px;
      background: #182224;
      color: var(--kfc-cyan-light);
      border-bottom: 1.5px solid #2c3e3e;
      position: sticky; top: 0; z-index: 11;
      box-shadow: 0 1px 16px #1bc1be1a;
    }
    .header .kfc-logo {
      height: 32px;
      vertical-align: middle;
      margin-right: 9px;
      border-radius: 8px;
      box-shadow: 0 1px 7px #0bd5e044;
      background: #fff;
    }
    .marquee-wrap {
      background: #182c2d;
      border-bottom: 1.2px solid #28e4e426;
      overflow: hidden;
      position: sticky;
      top: 0;
      z-index: 10;
      height: 38px;
    }
    .marquee-inner {
      white-space:nowrap;display:flex;
    }
    .marquee-text {
      color: var(--kfc-cyan-light);
      font-size: 1.06em; font-weight: 600; line-height:38px;
      white-space: nowrap;
      will-change: transform;
      text-shadow:0 1px 9px #182c2d7e;
      letter-spacing: 1px;
      padding-right: 32px;
    }
    .menu-wrap { max-width: 540px; margin: 0 auto; padding: 18px 0 75px 0;}
    .menu-item {
      display: flex; background: var(--kfc-card); border-radius: 18px;
      box-shadow: var(--kfc-shadow);
      margin:0 12px 18px 12px; padding: 14px 14px 19px 14px; align-items: flex-start;
      border: 1.6px solid var(--kfc-cyan);
      position: relative;
      flex-direction: row;
    }
    .menu-img {
      width: 68px; height: 68px; border-radius: 15px; object-fit: cover;
      background: #222b2c; margin-right: 15px; border: 2px solid var(--kfc-cyan-light);
      box-shadow:0 2px 10px #12e3c83a;
      flex-shrink: 0;
    }
    .menu-info { flex:1; min-width: 0; display:flex; flex-direction:column;}
    .menu-name {
      font-size: 1.13em; font-weight: 800; margin-bottom: 2.5px;
      color: var(--kfc-cyan-light); display: flex; align-items:center;
      text-shadow: 0 2px 7px #0be8db3c;
      flex-wrap: wrap;
      gap: 7px;
    }
    .menu-badge {
      display: inline-block; background: linear-gradient(90deg, var(--kfc-cyan-light), #70e5e7 75%);
      color: #156; border-radius: 8px; font-size: .86em; font-weight: 700;
      padding: 1.5px 9px 2.5px 9px; letter-spacing: 1px;
      margin-left: 5px;
      box-shadow:0 1px 5px #10f9e447;
    }
    .menu-type {
      display:inline-block; background: #22bbbb; color:var(--kfc-white);
      font-size:.86em; border-radius:8px; padding:2px 8px; margin-left:7px;
      border:1px solid #1cbfcf3b;
      font-weight: 500;
    }
    .menu-title { color:var(--kfc-cyan-light); font-size:.98em; margin-bottom:1px; margin-right:4px;}
    .menu-thccbd { color:#91f2ea; font-size:0.98em; font-weight:500; margin-bottom:2px; margin-right:10px;}
    .menu-desc { font-size:.97em; color:#e7feff; margin:8px 0 0 0; line-height:1.54;}
    .menu-bottom-prices {
      display: flex; gap: 14px;
      justify-content: flex-start;
      margin-top: 17px;
      position: static;
      padding: 0 4px 0 4px;
      flex-wrap: wrap;
    }
    .menu-spec {
      background: var(--kfc-cyan-dark); color: #fff; font-size:1.06em; border-radius:8px;
      padding:3.5px 13px; display:inline-block; border:1.1px solid var(--kfc-cyan-light);
      box-shadow:0 1px 8px #27c4c22a;
      margin-bottom:0;
      font-weight: 900;
    }
    .menu-price {
      color: #fff; background:var(--kfc-cyan); margin-left:6px; border-radius:5px;
      font-weight: 900; font-size:1.04em; padding: 0 5px;
      box-shadow:0 2px 4px #00e7e766;
      border: 1px solid var(--kfc-cyan-light);
      margin-right: 1px;
    }
    .footer { position:fixed; left:0; bottom:0; width:100vw; color:var(--kfc-cyan); background:#192525;
      font-size:.99em; text-align:center; padding:13px 0 9px 0; z-index:22; border-top: 1.6px solid #28e4e43a;}
    a { color: #33e3dd; text-decoration:underline; }
    /* 右下角悬浮按钮 */
    .float-btn {
      position: fixed;
      right: 23px;
      bottom: 80px;
      z-index: 999;
      background: linear-gradient(90deg,#25e7e3,#17bfb9 75%);
      color: #14595a;
      font-size: 1.07em;
      font-weight: 700;
      padding: 12px 26px 11px 26px;
      border-radius: 100px;
      box-shadow: 0 5px 20px #12d5c451;
      border: 0;
      cursor: pointer;
      outline: none;
      transition: all .17s;
      letter-spacing: 1px;
      border: 2px solid #82ffff1a;
    }
    .float-btn:hover {
      background: linear-gradient(90deg,#1bbfc3,#52ffef 85%);
      color: #14595a;
      box-shadow: 0 5px 24px #39fff451;
      border: 2px solid #fff;
    }
    @media (max-width:600px) {
      .menu-wrap { padding: 5px 0 70px 0;}
      .menu-item { margin: 0 3vw 15px 3vw; padding: 10px 5px 18px 5px;}
      .menu-img { width:54px; height:54px; margin-right:7px;}
      .menu-name { font-size: 1em;}
      .float-btn { right:12px; bottom:70px; padding:11px 19px;}
    }
    @media (max-width:400px){
      .menu-item { flex-direction: column; align-items: stretch;}
      .menu-img { margin: 0 0 10px 0; }
      .menu-bottom-prices { justify-content: center; gap: 7px;}
    }
  </style>
</head>
<body>
  <div class="header">
    <img class="kfc-logo" src="https://upload.wikimedia.org/wikipedia/commons/6/6e/KFC_logo.svg" alt="KFC" />
    KFC 420 菜单
  </div>
  <div class="marquee-wrap">
    <div class="marquee-inner" id="marqueeInner">
      <span class="marquee-text" id="marqueeText"></span>
      <span class="marquee-text" id="marqueeTextClone"></span>
    </div>
  </div>
  <div class="menu-wrap" id="menu"></div>
  <button class="float-btn" onclick="window.open('https://t.me/kfc420_support','_blank')">联系客服</button>
  <div class="footer">
    KFC420 &copy; Menu | <a href="https://t.me/T4H2C0_MEL" target="_blank">Telegram下单</a>
  </div>
  <script>
    // ---- Google Sheet 配置 ----
    const SHEET_ID = "1hUlRnvEy-k2Arz8SVKpRsAaBEFTyS6RDJBDfwDmM-Hs";          // TODO: 改成你的SheetId
    const SHEET_TAB_MENU = "batmenu";        // 菜单Tab
    const SHEET_TAB_NOTICE = "notice";       // 公告Tab
    // 推荐 opensheet.elk.sh
    const MENU_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_TAB_MENU}`;
    const NOTICE_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_TAB_NOTICE}`;

    // 跑马灯
    fetch(NOTICE_URL)
      .then(res=>res.json())
      .then(rows=>{
        let notices = rows.map(r=>r.msg).filter(Boolean);
        let text = notices.join("   |   ");
        const marquee = document.getElementById('marqueeText');
        const clone = document.getElementById('marqueeTextClone');
        marquee.innerText = text;
        clone.innerText = text;
        const inner = document.getElementById('marqueeInner');
        let speed = 1.3;
        let pos = 0;
        function scroll() {
          let unitWidth = marquee.offsetWidth;
          pos -= speed;
          if (Math.abs(pos) >= unitWidth) pos = 0;
          inner.style.transform = `translateX(${pos}px)`;
          requestAnimationFrame(scroll);
        }
        setTimeout(scroll, 350);
      });

    // 菜单渲染
    fetch(MENU_URL)
      .then(res=>res.json())
      .then(rows=>{
        const html = rows.map(obj=>{
          // 多规格
          let priceBtns = '';
          for(let i=1;i<=3;i++){
            if(obj['spec'+i] && obj['price'+i]){
              priceBtns += `<span class="menu-spec">${obj['spec'+i]} <span class="menu-price">${obj['price'+i]}</span></span>`;
            }
          }
          let thccbd = obj.thccbd || '';
          if(!thccbd && (obj.thc || obj.cbd)) thccbd = (obj.thc?obj.thc:'')+(obj.cbd?(' / '+obj.cbd):'');
          return `
            <div class="menu-item">
              ${obj.img ? `<img class="menu-img" src="${obj.img}" loading="lazy"/>` : ""}
              <div class="menu-info">
                <div class="menu-name">
                  ${obj.name || ""}
                  ${obj.badge ? `<span class="menu-badge">${obj.badge}</span>` : ""}
                  ${obj.type ? `<span class="menu-type">${obj.type}</span>` : ""}
                </div>
                <div style="display:flex;align-items:center;gap:9px;margin-bottom:2px;">
                  ${obj.title ? `<span class="menu-title">${obj.title}</span>` : ""}
                  ${thccbd ? `<span class="menu-thccbd">THC/CBD: ${thccbd}</span>` : ""}
                </div>
                ${obj.desc ? `<div class="menu-desc">${obj.desc}</div>` : ""}
                <div class="menu-bottom-prices">${priceBtns}</div>
              </div>
            </div>
          `;
        }).join('');
        document.getElementById('menu').innerHTML = html || `<div style="text-align:center;color:#ccc;margin-top:40px;">暂无菜单内容</div>`;
      })
      .catch(err=>{
        document.getElementById('menu').innerHTML = "<div style='text-align:center;color:var(--kfc-cyan);margin-top:36vw;font-size:1.08em;'>菜单加载失败，请刷新重试。</div>";
        console.error(err);
      });
  </script>
</body>
</html>

<!-- webapp_test.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Telegram WebApp æµ‹è¯•é¡µé¢ï¼ˆå¸¦æ‰‹åŠ¨æŒ‰é’®ï¼‰</title>
  <!-- ä¸€å®šè¦åŠ è½½è¿™è¡Œ JSï¼ŒTelegram å†…ç½®æµè§ˆå™¨æ‰ä¼šæ³¨å…¥ â€œTelegram.WebAppâ€ å¯¹è±¡ -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #fafafa;
      text-align: center;
    }
    .card {
      background: #c8e6c9;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 24px;
      color: #2e7d32;
    }
    .card h2 {
      margin: 0 0 8px;
      font-size: 20px;
    }
    .card p {
      margin: 4px 0;
      font-size: 14px;
    }
    #status {
      margin-top: 16px;
      color: #555;
      font-size: 14px;
    }
    #btnManual {
      margin-top: 24px;
      padding: 10px 16px;
      background: #42a5f5;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    #btnManual:active {
      background: #1e88e5;
    }
  </style>
</head>
<body>
  <h1>WebApp æµ‹è¯•é¡µé¢ï¼ˆæ‰‹åŠ¨+è‡ªåŠ¨ï¼‰</h1>

  <div class="card">
    <h2>âœ”ï¸ WebApp å·²åŠ è½½</h2>
    <p>å¹³å°ï¼š<span id="platform">æœªçŸ¥</span></p>
    <p>ç”¨æˆ· IDï¼š<span id="userId">æœªçŸ¥</span></p>
  </div>

  <p id="status">ç­‰å¾…ç”¨æˆ·æ“ä½œæˆ–è‡ªåŠ¨å‘é€â€¦â€¦</p>

  <!-- æ‰‹åŠ¨è§¦å‘æŒ‰é’®ï¼šç‚¹å‡»åä¹Ÿä¼šå‘é€åŒæ ·çš„ JSON -->
  <button id="btnManual">ğŸ“¤ æ‰‹åŠ¨å‘é€æµ‹è¯•æ•°æ®</button>

  <script>
    // 1. å…ˆåˆ¤æ–­æ˜¯å¦åœ¨ Telegram å†…ç½®æµè§ˆå™¨é‡Œ
    if (!window.Telegram || !Telegram.WebApp) {
      // å¦‚æœä¸æ˜¯æ¥è‡ª Telegram WebViewï¼Œå°±æç¤ºç”¨æˆ·
      document.getElementById("status").innerText = "âš ï¸ è¯·ä» Telegram ä¸­ç‚¹å‡»æŒ‰é’®æ‰“å¼€æ­¤é¡µé¢ã€‚";
    } else {
      const webApp = Telegram.WebApp;

      // 2. æ¸²æŸ“â€œå¹³å°â€ä¸â€œç”¨æˆ· IDâ€
      document.getElementById("platform").innerText = webApp.platform;
      document.getElementById("userId").innerText = webApp.initDataUnsafe.user?.id || "æœªçŸ¥";

      // 3. å…ˆè‡ªåŠ¨å±•å¼€çª—å£
      webApp.expand();

      // 4. è‡ªåŠ¨å®šæ—¶ï¼ˆ1 ç§’åï¼‰å‘é€ä¸€æ¬¡æ•°æ®
      setTimeout(() => {
        sendPayload();  // è°ƒç”¨ä¸‹æ–¹å°è£…çš„å‘é€å‡½æ•°
      }, 1000);

      // 5. â€œæ‰‹åŠ¨å‘é€â€æŒ‰é’®ç‚¹å‡»åï¼Œä¹Ÿä¼šè§¦å‘åŒæ ·çš„é€»è¾‘
      document.getElementById("btnManual").addEventListener("click", () => {
        sendPayload();
      });

      // 6. ç»Ÿä¸€çš„â€œå‘é€æ•°æ®â€å‡½æ•°
      function sendPayload() {
        document.getElementById("status").innerText = "â³ æ­£åœ¨å‘é€æµ‹è¯•æ•°æ®â€¦â€¦";
        console.log("sendData å‰", Date.now());
        const payload = {
          test: "hello_bot",
          timestamp: Date.now()
        };
        webApp.sendData(JSON.stringify(payload));
        console.log("sendData å", Date.now());
        setTimeout(() => {
          document.getElementById("status").innerText =
            "âœ… æµ‹è¯•æ•°æ®å·²å‘é€ï¼Œè¯·è¿”å›èŠå¤©çª—å£æŸ¥çœ‹ Bot å›å¤ã€‚";
        }, 500);
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WebApp æµ‹è¯•é¡µé¢</title>
  <!-- ä¸€å®šè¦å¼•ç”¨ Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
      text-align: center;
    }
    .box {
      max-width: 400px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .status {
      margin-bottom: 20px;
      font-size: 18px;
      line-height: 1.5;
    }
    .button {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 20px;
      background-color: #0088cc;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    .button:active {
      background-color: #006699;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>WebApp æµ‹è¯•é¡µé¢</h2>
    <div id="status" class="status">
      ğŸ”„ æ£€æµ‹ Telegram WebApp æ¨¡å¼â€¦â€¦
    </div>
    <!-- æ‰‹åŠ¨å‘é€æŒ‰é’®ï¼Œä»…å½“è‡ªåŠ¨å‘é€å¤±æ•ˆæ—¶ä½¿ç”¨ -->
    <button id="manualBtn" class="button" style="display:none;">ğŸ“¤ æ‰‹åŠ¨å‘é€æµ‹è¯•æ•°æ®</button>
  </div>

  <script>
    // ç­‰å¾… DOM åŠ è½½
    document.addEventListener("DOMContentLoaded", function() {
      // ä»å…¨å±€å¯¹è±¡è·å– Telegram WebApp å®ä¾‹
      const webApp = window.Telegram.WebApp;

      // ç¬¬ä¸€æ­¥ï¼šå‘Šè¯‰ Telegram å†…ç½®æµè§ˆå™¨ï¼Œæˆ‘ä»¬çš„é¡µé¢å·²ç»å‡†å¤‡å°±ç»ª
      webApp.ready();

      // ç¬¬äºŒæ­¥ï¼šæ›´æ–°é¡µé¢çŠ¶æ€ï¼Œæ˜¾ç¤ºâ€œå·²åŠ è½½â€
      const statusDiv = document.getElementById("status");
      statusDiv.innerHTML = `
        âœ”ï¸ WebApp å·²åŠ è½½<br/>
        å¹³å°ï¼š<strong>${webApp.platform || "unknown"}</strong><br/>
        ç”¨æˆ· IDï¼š<strong>${webApp.initDataUnsafe?.user?.id || "æœªçŸ¥"}</strong><br/>
        ç­‰å¾…è‡ªåŠ¨å‘é€æµ‹è¯•æ•°æ®â€¦â€¦
      `;

      // ç¬¬ä¸‰æ­¥ï¼šå°è¯•åœ¨ 1 ç§’åè‡ªåŠ¨è°ƒç”¨ sendData()
      setTimeout(function() {
        // å‡†å¤‡è¦å‘é€çš„ JSON å­—ç¬¦ä¸²
        const payload = {
          test: "hello_bot",
          timestamp: Date.now()
        };
        // åˆ‡æ¢çŠ¶æ€æ–‡å­—ä¸ºâ€œæ­£åœ¨å‘é€â€
        statusDiv.innerHTML = `
          â³ æ­£åœ¨å‘é€æµ‹è¯•æ•°æ®â€¦â€¦<br/>
          è¯·ç¨å€™â€¦â€¦
        `;
        // æ‰§è¡Œ sendData()
        webApp.sendData(JSON.stringify(payload));
        // 0.5 ç§’ååˆ‡æ¢ä¸ºâ€œå·²å‘é€â€
        setTimeout(function() {
          statusDiv.innerHTML = `
            âœ… æµ‹è¯•æ•°æ®å·²å‘é€ï¼Œè¯·è¿”å›èŠå¤©çª—å£æŸ¥çœ‹ Bot å›å¤ã€‚
          `;
        }, 500);
      }, 1000);

      // ç¬¬å››æ­¥ï¼šå¦‚æœè‡ªåŠ¨å‘é€å¤±è´¥ï¼Œç”¨æˆ·ç‚¹å‡»â€œæ‰‹åŠ¨å‘é€â€æŒ‰é’®æ—¶ä¹Ÿèƒ½è§¦å‘ sendData
      const manualBtn = document.getElementById("manualBtn");
      // å½“é¡µé¢æ»‘åŠ¨æˆ–è¶…æ—¶ 2 ç§’åï¼Œå°†æŒ‰é’®æ˜¾ç¤ºå‡ºæ¥ï¼Œä¾›æ‰‹åŠ¨è¡¥æ•‘
      setTimeout(function() {
        manualBtn.style.display = "inline-block";
      }, 2000);
      manualBtn.addEventListener("click", function() {
        const payload = {
          test: "hello_manual_click",
          timestamp: Date.now()
        };
        statusDiv.innerHTML = "â³ æ­£åœ¨æ‰‹åŠ¨å‘é€æµ‹è¯•æ•°æ®â€¦â€¦";
        webApp.sendData(JSON.stringify(payload));
        setTimeout(function() {
          statusDiv.innerHTML = "âœ… æ‰‹åŠ¨æµ‹è¯•æ•°æ®å·²å‘é€ï¼Œè¯·è¿”å›èŠå¤©çª—å£æŸ¥çœ‹ Bot å›å¤ã€‚";
        }, 500);
      });
    });
  </script>
</body>
</html>
